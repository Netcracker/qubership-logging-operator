##################### System formats #####################
##################### Kubernetes formats #####################

# klog format
# format reference https://google.github.io/glog/stable/logging/#log-files
[PARSER]
    Name        klog_trace_entry
    Format      regex
    Regex       ^(?<level>[VIWEF])(?<date>\d{4}\s+\d{2}:\d{2}:\d{2}\.\d+)\s+(?<pid>\d+)\s+(?<file>[^:]+:\d+)\]\s+(?<short_message>Trace\[(?<trace_id>\d+)\]:\s+"(?<operation>[^"]+)"\s+(?<kv_blob>.*[^(]+)\s+\((?:\d+-[A-Za-z]+-\d{4}\s\d{2}:\d{2}:\d{2}\.\d+)\)\s+\(total\s+time:\s+(?<duration>\d+ms)\):?[\s\S]*)

[PARSER]
    Name        klog_entry
    Format      regex
    Regex       ^(?<level>[VIWEF])(?<date>\d{4}\s+\d{2}:\d{2}:\d{2}\.\d+)\s+(?<pid>\d+)\s+(?<file>[^:]+:\d+)\]\s+(?<short_message>[\s\S]*)

[PARSER]
    Name         coredns
    Format       regex
    Regex        ^\[(?<level>[A-Z]+)\]\s+(?<module>[^:]+):\s+(?:(?<id>\d+)\s+)?(?:(?<domain>[^\s]+)\s+(?<record_type>(?:AAAA|CNAME|MX|NS|TXT|SRV|PTR|SOA|A)):\s+)?(?:(?<file>[a-zA-Z@\-\.\d\/]+:\d+):\s+)?(?<short_message>.*)$
    Time_Keep    On

# Ingress-nginx logs format
# format reference https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/log-format/
[PARSER]
    Name k8s-nginx-ingress
    Format regex
    Regex ^(?<short_message>(?<host>[^ ]*) - (?<user>[^ ]*) \[[^\]]*\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*)) (?<size>[^ ]*) "(?<referer>[^\"]*)" "(?<agent>[^\"]*)" (?<request_length>[^ ]*) (?<request_time>[^ ]*) \[(?<proxy_upstream_name>[^ ]*)\] (\[(?<proxy_alternative_upstream_name>[^ ]*)\] )?(?<upstream_addr>[^ ]*) (?<upstream_response_length>[^ ]*) (?<upstream_response_time>[^ ]*) (?<upstream_status>[^ ]*) (?<reg_id>[^ ]*).*$
    Time_Key time
    Time_Format %d/%b/%Y:%H:%M:%S %z

##################### Common / Well-known formats #####################

# Logfmt format
# format reference https://brandur.org/logfmt
[PARSER]
    Name                logfmt
    Format              logfmt
    Logfmt_No_Bare_Keys true

# JSON log format
[PARSER]
    Name         json
    Format       json
    Time_Key     time
    Time_Format  %s
    Time_Keep    on

# Regex to parse only syslog-known log levels
# supported levels https://en.wikipedia.org/wiki/Syslog#Severity_level
[PARSER]
    Name         level_parser_common_keep
    Format       regex
    Regex        /\[\s*(?<level>(?i)alert|trace|debug|notice|info(?:r)?|warn(?:ing)?|err(?:or)?|crit(?:ical)?|fatal|severe|emerg(?:ency)?)\s*\]/
    Time_Key     time
    Time_Format  %Y-%m-%dT%H:%M:%S
    Time_Keep    On

##################### Service / Applications formats #####################

# MongoDB JSON log format
# format reference https://www.mongodb.com/docs/manual/reference/log-messages/#structured-logging
[PARSER]
    Name        mongodb_structured
    Format      regex
    # Fatal, Error, Warning, Info, D1-D5 - Debug
    Regex       ^\{"t":\{"\$date":"(?<date>[^"]+)"\},\s*"s":"(?<level>\w\d?)",\s*"c":"(?<component>\w+)",\s*"id":(?<id>\d+),\s*"ctx":"(?<context>[^"]+)",\s*"msg":"(?<short_message>[^"]+)"(?:,\s*"attr":(?<attributes>\{.*\}))?\}$
    Time_Key    time
    Time_Format %s

# RabbitMQ log format
# format reference https://www.rabbitmq.com/docs/logging
[PARSER]
    Name        rabbitmq
    Format      regex
    Regex       ^=(?<severity>[^ ]\w+)\s+REPORT[=\S]*[^ =][-:.\d\w]+[\S=]+(?<log>.*)$
    Time_Key    log_time
    Time_Format %d-%b-%Y::%H:%M:%S
    Time_Keep   Off

# PostgreSQL log format
# format reference https://www.postgresql.org/docs/current/runtime-config-logging.html
[PARSER]
    Name        postgres
    Format      regex
    Regex       ^[^A-Z]*(?:[A-Z]{3})?\s+(?<level>\w*)\W\s+(?<short_message>[^\n]*)
    Time_Key    time
    Time_Format %s

# Cassandra log format
# format reference https://cassandra.apache.org/doc/latest/cassandra/troubleshooting/reading_logs.html
[PARSER]
    Name        cassandra
    Format      regex
    Regex       ^(\[[^\]]*\]\s*)?\[?(?<level>[^\]]*)\]?\s*\[\w*\W(?<method>[^\]]*)\](?<short_message>[\s\S]*)
    Time_Key    time
    Time_Format %s

# Consul log format
# format reference ?
[PARSER]
    Name        consul
    Format      regex
    Regex       ^[^\s]*\s\[(?<level>[^\s]*)\]\s(?<short_message>[^\n]*)
    Time_Key    time
    Time_Format %s

# Fluentbit log format
[PARSER]
    Name        fluentbit
    Format      regex
    Regex       ^\[(?<date>\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2}:\d{2})\]\s\[\s*(?<level>[^\]\s]+)\s*\]\s\[(?<component>[^\]]+)\](?<short_message>[\s\S]+)
    Time_Key    time
    Time_Format %s

[PARSER]
    Name        java
    Format      regex
    Regex       ^\[(?<date>\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}[\.,]\d{3}Z?)\]\s*\[\s*(?<level>(?:TRACE|DEBUG|INFO|WARN|ERROR))\s*\](?<short_message>[\s\S]+)
    Time_Key    time
    Time_Format %s

[PARSER]
    Name        opensearch
    Format      regex
    Regex       ^\[(?<date>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[\.,]\d{3}Z?)\]\s*\[\s*(?<level>(?:TRACE|DEBUG|INFO|WARN|ERROR))\s*\]\s*\[\s*(?<logger>[^]]+)\s*\]\s*\[\s*(?<opensearch_node>[^]]+)\s*\](?<short_message>[\s\S]+)
    Time_Key    time
    Time_Format %s
[PARSER]
    Name        qubership
    Format      regex
    Regex       ^\[(?<date>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z)\]\s*\[\s*(?<level>(?:TRACE|DEBUG|INFO|WARN|ERROR))\s*\]\s*\[\s*request_id\s*=\s*[^\]\[\s=]+\s*\]\s*\[\s*tenant_id\s*=\s*[^\]\[\s=]+\s*\]\s*\[\s*thread\s*=\s*[^\]\[\s=]+\s*\]\s*\[\s*class\s*=\s*[^\]\[\s=]+\s*\]\s*(?:\s*\[\s*[^\]\[\s=]+\s*=\s*[^\]\[\s=]+\s*\])*\s+(?<short_message>[^\[\]\s][\s\S]+)
    Time_Key    time
    Time_Format %s

##################### For integration test purposes #####################

# Log format for integration tests purposes
[PARSER]
    Name        logId-test
    Format      regex
    Regex       .*logId=\"(?<logId>[a-z0-9_\-]+).*
