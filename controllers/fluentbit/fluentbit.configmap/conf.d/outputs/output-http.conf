{{- if and .Values.Fluentbit.Output .Values.Fluentbit.Output.Http .Values.Fluentbit.Output.Http.Enabled }}
[OUTPUT]
    name                   http
    Match_Regex            (audit|system|pods|klog).*
    host                   {{ .Values.Fluentbit.Output.Http.Host }}
    port                   {{ .Values.Fluentbit.Output.Http.Port | default 9428 }}
    uri                    {{ .Values.Fluentbit.Output.Http.Uri }}
    json_date_format       {{ .Values.Fluentbit.Output.Http.JsonDateFormat | default "iso8601" }}
{{- if .Values.Fluentbit.Output.Http.Auth }}
{{- if .Values.Fluentbit.Output.Http.Auth.Token }}
    header                 Authorization "Bearer ${HTTP_TOKEN}"
{{- end }}
{{- if and .Values.Fluentbit.Output.Http.Auth.User .Values.Fluentbit.Output.Http.Auth.Password }}
    http_user ${HTTP_USERNAME}
    http_passwd ${HTTP_PASSWORD}
{{- end }}
{{- end }}
{{- if .Values.Fluentbit.Output.Http.Compress }}
    compress               {{ .Values.Fluentbit.Output.Http.Compress }}
{{- end }}
    format                 {{ .Values.Fluentbit.Output.Http.Format | default "json_lines" }}
{{- if .Values.Fluentbit.Output.Http.TLS }}
    tls                    {{ if .Values.Fluentbit.Output.Http.TLS.Enabled }}On{{ else }}Off{{ end }}
{{- if .Values.Fluentbit.Output.Http.TLS.Enabled }}
{{- if .Values.Fluentbit.Output.Http.TLS.Verify }}
    tls.verify             On
{{- else }}
    tls.verify             Off
{{- end }}
{{- if and .Values.Fluentbit.Output.Http.TLS.CA .Values.Fluentbit.Output.Http.TLS.CA.SecretName .Values.Fluentbit.Output.Http.TLS.CA.SecretKey }}
    tls.ca_file            /fluent-bit/output/http/tls/ca.crt
{{- end }}
{{- if and .Values.Fluentbit.Output.Http.TLS.Cert .Values.Fluentbit.Output.Http.TLS.Cert.SecretName .Values.Fluentbit.Output.Http.TLS.Cert.SecretKey }}
    tls.crt_file           /fluent-bit/output/http/tls/tls.crt
{{- end }}
{{- if and .Values.Fluentbit.Output.Http.TLS.Key .Values.Fluentbit.Output.Http.TLS.Key.SecretName .Values.Fluentbit.Output.Http.TLS.Key.SecretKey }}
    tls.key_file           /fluent-bit/output/Http/tls/tls.key
{{- end }}
{{- if .Values.Fluentbit.Output.Http.TLS.KeyPasswd }}
    tls.key_passwd         {{ .Values.Fluentbit.Output.Http.TLS.KeyPasswd }}
{{- end }}
{{- end }}
{{- end }}
{{ .Values.Fluentbit.Output.Http.ExtraParams | nindent 4 }}
{{- end }}
