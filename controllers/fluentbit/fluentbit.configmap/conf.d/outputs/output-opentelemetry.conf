{{- if and .Values.Fluentbit.Output .Values.Fluentbit.Output.Otel .Values.Fluentbit.Output.Otel.Enabled }}
[OUTPUT]
    name                            opentelemetry
    Match_Regex                     (audit|system|pods|klog).*
    host                            {{ .Values.Fluentbit.Output.Otel.Host }}
    port                            {{ .Values.Fluentbit.Output.Otel.Port | default 9428 }}
    logs_uri                        {{ .Values.Fluentbit.Output.Otel.LogsUri | default "/insert/opentelemetry/v1/logs" }}
    header                          VL-Stream-Fields    stream
    header                          VL-Time-Field       time
    logs_body_key                   short_message
    logs_body_key_attributes        true
    logs_severity_text_message_key  $level
{{- if .Values.Fluentbit.Output.Otel.Auth }}
{{- if .Values.Fluentbit.Output.Otel.Auth.Token }}
    header                          Authorization    Bearer ${OTEL_TOKEN}
{{- end }}
{{- if and .Values.Fluentbit.Output.Otel.Auth.User .Values.Fluentbit.Output.Otel.Auth.Password }}
    http_user                       ${OTEL_USERNAME}
    http_passwd                     ${OTEL_PASSWORD}
{{- end }}
{{- end }}
{{- if .Values.Fluentbit.Output.Otel.Compress }}
    compress                        {{ .Values.Fluentbit.Output.Otel.Compress }}
{{- end }}
{{- if .Values.Fluentbit.Output.Otel.LogSuppressInterval }}
    log_suppress_interval           {{ .Values.Fluentbit.Output.Otel.LogSuppressInterval }}
{{- end }}
{{- if .Values.Fluentbit.Output.Otel.TLS }}
    tls                             {{ if .Values.Fluentbit.Output.Otel.TLS.Enabled }}On{{ else }}Off{{ end }}
{{- if .Values.Fluentbit.Output.Otel.TLS.Enabled }}
{{- if .Values.Fluentbit.Output.Otel.TLS.Verify }}
    tls.verify                      On
{{- else }}
    tls.verify                      Off
{{- end }}
{{- if and .Values.Fluentbit.Output.Otel.TLS.CA .Values.Fluentbit.Output.Otel.TLS.CA.SecretName .Values.Fluentbit.Output.Otel.TLS.CA.SecretKey }}
    tls.ca_file                     /fluent-bit/output/otel/tls/ca.crt
{{- end }}
{{- if and .Values.Fluentbit.Output.Otel.TLS.Cert .Values.Fluentbit.Output.Otel.TLS.Cert.SecretName .Values.Fluentbit.Output.Otel.TLS.Cert.SecretKey }}
    tls.crt_file                    /fluent-bit/output/otel/tls/tls.crt
{{- end }}
{{- if and .Values.Fluentbit.Output.Otel.TLS.Key .Values.Fluentbit.Output.Otel.TLS.Key.SecretName .Values.Fluentbit.Output.Otel.TLS.Key.SecretKey }}
    tls.key_file                    /fluent-bit/output/otel/tls/tls.key
{{- end }}
{{- if .Values.Fluentbit.Output.Otel.TLS.KeyPasswd }}
    tls.key_passwd                  {{ .Values.Fluentbit.Output.Otel.TLS.KeyPasswd }}
{{- end -}}
{{- end -}}
{{- end -}}
{{ .Values.Fluentbit.Output.Otel.ExtraParams | nindent 4 }}
{{- end }}
