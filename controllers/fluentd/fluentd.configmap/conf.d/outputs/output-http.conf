{{- if and .Values.Fluentd.Output .Values.Fluentd.Output.Http .Values.Fluentd.Output.Http.Enabled }}
<store ignore_error>
  @type http
  @id output_http
  {{- $host := .Values.Fluentd.Output.Http.Host }}
  {{- $path := .Values.Fluentd.Output.Http.Path | default "/insert/jsonline" }}
  endpoint     {{ printf "%s%s" $host $path }}
  {{- if and .Values.Fluentd.Output.Http.Auth .Values.Fluentd.Output.Http.Auth.User .Values.Fluentd.Output.Http.Auth.Password }}
  <auth>
    method     basic
    username   "#{ENV['HTTP_USERNAME']}"
    password   "#{ENV['HTTP_PASSWORD']}"
  </auth>
  {{- end }}
  {{- if .Values.Fluentd.Output.Http.Headers }}
  headers      {{ .Values.Fluentd.Output.Http.Headers | toJson }}
  {{- else }}
  headers      {{ printf `{"VL-Msg-Field": "log", "VL-Time-Field": "time", "VL-Stream-Fields": "stream"}` }}
  {{- end }}
  compress     {{ .Values.Fluentd.Output.Http.Compress | default "gzip" }}
  {{- if and .Values.Fluentd.Output.Http.TLS .Values.Fluentd.Output.Http.TLS.Enabled }}
  {{- if and .Values.Fluentd.Output.Http.TLS.CA .Values.Fluentd.Output.Http.TLS.CA.SecretName .Values.Fluentd.Output.Http.TLS.CA.SecretKey }}
  tls_ca_cert_path "/fluentd/output/http/tls/ca.crt"
  {{- end }}
  {{- if and .Values.Fluentd.Output.Http.TLS.Cert .Values.Fluentd.Output.Http.TLS.Cert.SecretName .Values.Fluentd.Output.Http.TLS.Cert.SecretKey }}
  tls_client_cert_path "/fluentd/output/http/tls/tls.crt"
  {{- end }}
  {{- if and .Values.Fluentd.Output.Http.TLS.Key .Values.Fluentd.Output.Http.TLS.Key.SecretName .Values.Fluentd.Output.Http.TLS.Key.SecretKey }}
  tls_private_key_path "/fluentd/output/http/tls/tls.key"
  {{- end }}
  {{- if .Values.Fluentd.Output.Http.TLS.VerifyMode }}
  tls_verify_mode {{ .Values.Fluentd.Output.Http.TLS.VerifyMode }}
  {{- end }}
  {{- if .Values.Fluentd.Output.Http.TLS.Ciphers }}
  tls_ciphers {{.Values.Fluentd.Output.Http.TLS.Ciphers }}
  {{- end }}
  {{- if .Values.Fluentd.Output.Http.TLS.Version }}
  tls_version {{ .Values.Fluentd.Output.Http.TLS.Version }}
  {{- end -}}
  {{- end -}}
{{- if .Values.Fluentd.Output.Http.ExtraParams -}}
{{ .Values.Fluentd.Output.Http.ExtraParams | nindent 2 }}
{{- end }}
</store>
{{- end }}
